//*********************************************
//    Framework/Mixins/Content/Fonts
//*********************************************

@import 'SassyLists';

// глобальная переменная. в неё будут добавляться все шрифты и из неё же извлекаться
$sf-fonts: ();

// стеки безопасных шрифтов
$sf-fonts-safe: (
  arial-black:      ('Arial Black', 'Helvetica CY', 'Nimbus Sans L', 'sans-serif'),
  arial:            ('Arial', 'Helvetica CY', 'Nimbus Sans L', 'sans-serif'),
  courier:          ('Courier New', 'Nimbus Mono L', 'Monospace'),
  georgia:          ('Georgia', 'Century Schoolbook L', 'serif'),
  impact:           ('Impact', 'Charcoal CY', 'sans-serif'),
  times-new-roman:  ('Times New Roman', 'Times CY', 'Nimbus Roman No9 L', 'serif'),
  trebuchet:        ('Trebuchet MS', 'Helvetica CY', 'sans-serif'),
  verdana:          ('Verdana', 'Geneva CY', 'DejaVu Sans', 'sans-serif'),
  tahoma:           ('Tahoma', 'Geneva CY', 'sans-serif')
);

// поумолчательные параметры шрифтов
$sf-fonts-types: (
  regular:      (weight: normal, style: normal),
  bold:         (weight: 700,    style: normal),
  italic:       (weight: normal, style: italic),
  bold-italic:  (weight: 700,    style: italic)
);


@function sf-fonts-add ($fonts) {
  @if (type-of($fonts) != list and type-of($fonts) != map) {
    @return $sf-fonts;
  }

  $_fonts: $fonts;

  // нам нужен list шрифтов.
  // если пришёл обычный map, то надо завернуть его в список
  @if (type-of($_fonts) == map and map-has-key($_fonts, name) and map-has-key($_fonts, stack)) {
    $_fonts: ($_fonts,);
  }

  @each $font in $_fonts {
    @if (type-of($font) == map && map-has-key($font, name) and map-has-key($font, stack)) {

      @if (map-has-key($font, type) != true) {
        $font: map-merge($font, (type: regular));
      }
      @if (map-has-key($font, weight) != true) {
        $font: map-merge($font, (weight: 400));
      }
      @if (map-has-key($font, style) != true) {
        $font: map-merge($font, (style: normal));
      }

      $stack: map-get($font, stack);
      $stack: sl-to-list($stack);
      $font: map-merge($font, (stack: $stack));

      $sf-fonts: append($sf-fonts, $font) !global;
    }
  }

  @return $sf-fonts;
}

@function sf-fonts-get ($name, $type: regular) {
  @each $font in $sf-fonts {
    @if (map-get($font, name) == $name and map-get($font, type) == $type) {
      @return $font;
    }
  }

  @return null;
}

@function sf-fonts-stack ($name, $type: regular, $to-string: true) {
  $font: sf-fonts-get($name, $type);
  $stack: ();

  @if ($font != null) {
    $stack: map-get($font, stack);

    @if (sf-is-true($to-string)) {
      $stack: unquote('"#{sl-to-string($stack, '", "')}"');
    } @else {
      $stack: sl-to-list($stack);
    }
  }

  @return $stack;
}

@mixin sf-font ($name, $type: regular) {
  $font: sf-fonts-get($name, $type);

  @if ($font != null) {
    font-family: sf-implode(', ', map-get($font, stack));
    font-weight: map-get($font, weight);
    font-style: map-get($font, style);
  }
}


// добавим стандартные безопасные стеки шрифтов
@each $name, $stack in $sf-fonts-safe {
  @each $font-type in $sf-fonts-types {
    $font: (
      name:   $name,
      stack:  $stack,
      type:   map-get($font-type, 'type'),
      weight: map-get($font-type, 'weight'),
      style:  map-get($font-type, 'style')
    );
    $sf-fonts: sf-fonts-add($font);
  }
}

// и, не отходя от кассы, добавим популярные веб-шрифты
$tahomaStack: sf-fonts-stack(tahoma);

$sf-fonts: sf-fonts-add((
  (name: ptsans, type: regular,     weight: 400, style: normal, stack: sl-prepend($tahomaStack, "PTSans")),
  (name: ptsans, type: italic,      weight: 400, style: italic, stack: sl-prepend($tahomaStack, "PTSansItalic")),
  (name: ptsans, type: bold,        weight: 700, style: normal, stack: sl-prepend($tahomaStack, "PTSansBold")),
  (name: ptsans, type: bold-italic, weight: 700, style: italic, stack: sl-prepend($tahomaStack, "PTSansBoldItalic")),
));

